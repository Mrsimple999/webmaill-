<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ACC M·ªπ & Email</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    :root {
      --main-blue: #007bff;
      --main-green: #28a745;
      --main-red: #dc3545;
      --main-gray: #6c757d;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f0f2f5;
      margin: 0 auto;
      padding: 10px;
      max-width: 430px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 10px;
      box-sizing: border-box;
    }

    section {
      background: white;
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    textarea, input {
      font-size: 15px;
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    /* Nh√≥m n√∫t l·∫•y acc */
    .btn-group {
      display: flex;
      gap: 8px;
      width: 100%;
      margin-bottom: 8px;
    }
    .btn-group button {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      color: white;
      cursor: pointer;
    }

    #accCopyBtnTop { background: var(--main-green); }
    #accRandomBtnTop { background: var(--main-gray); }

    /* N√∫t trong ph·∫ßn th√™m/x√≥a */
    .btn-group-small {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      width: 100%;
    }
    .btn-group-small button {
      flex: 1;
      padding: 12px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      color: white;
      cursor: pointer;
      background: var(--main-blue);
    }
    .btn-red { background: var(--main-red); }

    .input-container {
      display: flex;
      gap: 6px;
      margin-top: 6px;
      width: 100%;
    }
    .input-container input {
      flex: 1;
      padding: 8px;
    }
    .input-container button {
      flex: 0 0 44px;
      font-size: 18px;
      padding: 0;
    }

    p {
      font-size: 13px;
      margin-top: 4px;
    }

    #accInput, #emailInput {
      height: 55px;
      font-size: 14px;
    }

    html, body { overflow: hidden; }

    #customToast {
      position: fixed;
      top: -100px;
      left: 0;
      width: 100%;
      background-color: #343a40;
      color: white;
      text-align: center;
      padding: 14px 10px;
      font-size: 16px;
      font-weight: bold;
      z-index: 9999;
      transition: top 0.5s ease-in-out;
    }
    #customToast.show { top: 0; }
    #customToast.error { background-color: #d93025; }
    #customToast.success { background-color: #28a745; }

    #emailCopyBtn {
      font-size: 18px;
      padding: 14px;
      background: var(--main-green);
      color: white;
      border: none;
      width: 100%;
      border-radius: 10px;
      margin-top: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }

    #emailCopyBtn span {
      font-size: 14px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="customToast"></div>

<!-- ‚úÖ Nh√≥m n√∫t l·∫•y / ƒë·ªïi ACC M·ªπ -->
<div class="btn-group">
  <button id="accCopyBtnTop">üìã L·∫•y ACC M·ªπ</button>
  <button id="accRandomBtnTop">üîÑ ƒê·ªïi ACC M·ªπ</button>
</div>

<!-- ================= ACC M·ª∏ ================= -->
<section>
  <textarea id="accInput" placeholder="D√°n ACC M·ªπ (ngƒÉn c√°ch b·∫±ng xu·ªëng d√≤ng ho·∫∑c , ; :)"></textarea>
  <div class="btn-group-small">
    <button id="accAddBtn">‚ûï Th√™m ACC</button>
    <button id="accDeleteCurrentBtnTop" class="btn-red" title="X√≥a ACC hi·ªán t·∫°i">üóëÔ∏è X√≥a ACC</button>
  </div>
  <div class="input-container">
    <input type="text" id="accOutput" placeholder="ACC M·ªπ hi·ªÉn th·ªã..." readonly>
    <button id="accCopyManual" title="Copy ACC">üìã</button>
  </div>
  <p id="accCount"></p>
</section>

<!-- ================= EMAIL ================= -->
<section>
  <textarea id="emailInput" placeholder="D√°n email..."></textarea>
  <div class="btn-group-small">
    <button id="emailAddBtn">‚ûï Th√™m Email</button>
    <button id="emailDeleteAllBtn" class="btn-red" title="X√≥a to√†n b·ªô email">üóëÔ∏è X√≥a Email</button>
  </div>
  <div class="input-container">
    <input type="text" id="emailOutput" placeholder="Email hi·ªÉn th·ªã..." readonly>
    <button id="emailCopyManual" title="Copy Email">üìã</button>
  </div>
  <button id="emailCopyBtn">üìã L·∫•y & Copy Email <span id="emailCount"></span></button>
</section>

<script>
  // ================== FIREBASE ==================
  const firebaseConfig = {
    apiKey: "AIzaSyB9elXt44pt-DGYygIOWQog8XE-YqQO_I8",
    authDomain: "email-sync-tool.firebaseapp.com",
    databaseURL: "https://email-sync-tool-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "email-sync-tool",
    storageBucket: "email-sync-tool.appspot.com",
    messagingSenderId: "902586987378",
    appId: "1:902586987378:web:b151f5d50773490816e3eb"
  };
  firebase.initializeApp(firebaseConfig);

  // ================== TOAST ==================
  function showToast(msg, isError = false, isSuccess = false) {
    const toast = document.getElementById('customToast');
    toast.textContent = msg;
    toast.className = '';
    toast.classList.add('show');
    if (isError) toast.classList.add('error');
    if (isSuccess) toast.classList.add('success');
    setTimeout(() => toast.classList.remove('show'), 3000);
  }

  function copyText(text) {
    navigator.clipboard.writeText(text)
      .then(() => showToast(`‚úÖ ƒê√£ copy: ${text}`, false, true))
      .catch(() => showToast('‚ö†Ô∏è Kh√¥ng th·ªÉ copy.', true));
  }

  // ================== ACC M·ª∏ ==================
  const accRef = firebase.database().ref('accUSA');
  let accList = [];
  let currentAccIndex = 0;

  accRef.on('value', snap => {
    accList = snap.val() || [];
    document.getElementById('accCount').textContent = `üìä ACC c√≤n l·∫°i: ${accList.length}`;
    if (currentAccIndex >= accList.length) currentAccIndex = 0;
  });

  document.getElementById('accAddBtn').addEventListener('click', () => {
    const text = document.getElementById('accInput').value.trim();
    if (!text) return showToast('‚ö†Ô∏è Ch∆∞a nh·∫≠p ACC', true);
    const lines = text.split(/[\n,;:|]+/).map(e => e.trim()).filter(e => e);
    accRef.transaction(list => {
      list = list || [];
      lines.forEach(acc => { if (!list.includes(acc)) list.push(acc); });
      return list;
    }, () => showToast(`‚úÖ ƒê√£ th√™m ${lines.length} ACC`, false, true));
    document.getElementById('accInput').value = '';
  });

  // üìã L·∫•y acc ƒë·∫ßu ti√™n
  document.getElementById('accCopyBtnTop').addEventListener('click', () => {
    if (accList.length === 0) return showToast('‚ö†Ô∏è H·∫øt ACC M·ªπ', true);
    currentAccIndex = 0;
    const acc = accList[currentAccIndex];
    document.getElementById('accOutput').value = acc;
    copyText(acc);
  });

  // üîÑ ƒê·ªïi acc theo th·ª© t·ª±
  document.getElementById('accRandomBtnTop').addEventListener('click', () => {
    if (accList.length === 0) return showToast('‚ö†Ô∏è H·∫øt ACC M·ªπ', true);
    currentAccIndex++;
    if (currentAccIndex >= accList.length) currentAccIndex = 0;
    const acc = accList[currentAccIndex];
    document.getElementById('accOutput').value = acc;
    copyText(acc);
  });

  document.getElementById('accDeleteCurrentBtnTop').addEventListener('click', () => {
    const currentAcc = document.getElementById('accOutput').value.trim();
    if (!currentAcc) return showToast('‚ö†Ô∏è Kh√¥ng c√≥ ACC ƒëang hi·ªÉn th·ªã', true);

    const index = accList.indexOf(currentAcc);
    if (index === -1) return showToast('‚ö†Ô∏è ACC n√†y kh√¥ng c√≤n trong danh s√°ch', true);

    accRef.transaction(list => {
      if (!list) return [];
      list.splice(index, 1);
      return list;
    }, (error) => {
      if (error) showToast('‚ö†Ô∏è L·ªói khi x√≥a ACC', true);
      else {
        showToast(`üóëÔ∏è ƒê√£ x√≥a ACC: ${currentAcc}`, false, true);
        document.getElementById('accOutput').value = '';
        if (currentAccIndex >= accList.length - 1) currentAccIndex = 0;
      }
    });
  });

  document.getElementById('accCopyManual').addEventListener('click', () => {
    const acc = document.getElementById('accOutput').value;
    if (!acc) return showToast('‚ö†Ô∏è Kh√¥ng c√≥ ACC ƒë·ªÉ copy', true);
    copyText(acc);
  });

  // ================== EMAIL ==================
  const emailRef = firebase.database().ref('emails');
  let emailList = [];

  emailRef.on('value', snap => {
    emailList = snap.val() || [];
    document.getElementById('emailCount').textContent = emailList.length;
  });

  document.getElementById('emailAddBtn').addEventListener('click', () => {
    const text = document.getElementById('emailInput').value.trim();
    if (!text) return showToast('‚ö†Ô∏è Ch∆∞a nh·∫≠p email', true);
    const parts = text.split(/[\s,;|]+/).map(e => e.trim()).filter(e => e);
    emailRef.transaction(list => {
      list = list || [];
      parts.forEach(e => { if (!list.includes(e)) list.push(e); });
      return list;
    }, () => showToast(`‚úÖ ƒê√£ th√™m ${parts.length} email`, false, true));
    document.getElementById('emailInput').value = '';
  });

  document.getElementById('emailDeleteAllBtn').addEventListener('click', () => {
    if (!confirm('X√≥a to√†n b·ªô email?')) return;
    emailRef.set([]);
    showToast('üóëÔ∏è ƒê√£ x√≥a to√†n b·ªô email', false, true);
  });

  document.getElementById('emailCopyManual').addEventListener('click', () => {
    const email = document.getElementById('emailOutput').value;
    if (!email) return showToast('‚ö†Ô∏è Kh√¥ng c√≥ email ƒë·ªÉ copy', true);
    copyText(email);
  });

  document.getElementById('emailCopyBtn').addEventListener('click', () => {
    if (emailList.length === 0) return showToast('‚ö†Ô∏è H·∫øt email', true);
    const index = Math.floor(Math.random() * emailList.length);
    const email = emailList[index];
    document.getElementById('emailOutput').value = email;
    copyText(email);
    emailRef.transaction(list => {
      list.splice(index, 1);
      return list;
    });
  });
</script>
</body>
</html>
